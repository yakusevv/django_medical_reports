{% extends 'reports/base_reports.html' %}
{% load i18n %}

{% block title %}
  {{ block.super }} - {{ report.ref_number }} - {% trans "View" %}
{% endblock %}

{% block admin-panel-content %}
{% if not report.checked %}
<a class="btn btn-secondary" href="{{ report.get_update_url }}">{% trans "Edit report" %}</a>
<a class="btn btn-danger" href="{{ report.get_delete_url }}">{% trans "Delete report" %}</a>
{% endif %}
{% endblock %}


{% block content %}
<div class="container mt-4">
  <div class="row mb-2">
    <div class="col offset-md-4">
      <div class="col mb-3">
      {% if request.user.is_staff %}
        <b>
        <a href="{{ report.docx_download_link }}" style='{% if report.checked %} color: gray {% endif %}' download>
          {{ report.ref_number }} {{ report.patients_last_name }} {{ report.patients_first_name }}
        </a>
        </b>
      {% else %}
      <b>
      {{ report.ref_number }} {{ report.patients_last_name }} {{ report.patients_first_name }}
      </b>
      {% endif %}
      </div>
    </div>
  </div>
  <div class="row mb-2 col-md-12 border-top">
    <div class="col-sm-3">
      <b> {% trans "Company, ref. number:" %} </b>
    </div>
    <div class="col">
      {{ report.company }}
      {{ report.company_ref_number }}
    </div>
  </div>
  <div class="row mb-2 col-md-12 border-top">
    <div class="col-sm-3">
      <b> {% trans "Date of birth" %} </b>
    </div>
    <div class="col">
      {{ report.patients_date_of_birth }}
    </div>
  </div>
  {% if report.patients_policy_number %}
  <div class="row mb-2 col-md-12 border-top">
    <div class="col-sm-3">
      <b> {% trans "Policy:" %} </b>
    </div>
    <div class="col">
      {{ report.patients_policy_number }}
    </div>
  </div>
  {% endif %}
  <div class="row mb-2 col-md-12 border-top">
    <div class="col-sm-3">
      <b> {% trans "Date of visit" %} </b>
    </div>
    <div class="col">
      {{ report.date_of_visit }}
    </div>
  </div>
  <div class="row mb-2 col-md-12 border-top">
    <div class="col-sm-3">
      <b> {% trans "Location:" %} </b>
    </div>
    <div class="col">
      {{ report.city.district.region }}, {{ report.city }}
      {% if report.detailed_location %}
      <p> {{ report.detailed_location }} </p>
      {% endif %}
    </div>
  </div>
  <div class="row mb-2 col-md-12 border-top">
    <div class="col-sm-3">
      <b> {% trans "Type of visit" %} </b>
    </div>
    <div class="col">
      {{ report.type_of_visit }}
    </div>
  </div>
  <div class="row mb-2 col-md-12 border-top">
    <div class="col-sm-3">
      <b> {% trans "Cause of visit:" %} </b>
    </div>
    <div class="col">
      {{ report.cause_of_visit|linebreaks }}
    </div>
  </div>
  <div class="row mb-2 col-md-12 border-top">
    <div class="col-sm-3">
      <b> {% trans "Checkup" %} </b>
    </div>
    <div class="col">
      {{ report.checkup|linebreaks }}
    </div>
  </div>
  {% if report.additional_checkup %}
  <div class="row mb-2 col-md-12 border-top">
    <div class="col-sm-3">
      <b> {% trans "Additional checkup:" %} </b>
    </div>
    <div class="col">
      {{ report.additional_checkup|linebreaks }}
    </div>
  </div>
  {% endif %}
  <div class="row mb-2 col-md-12 border-top">
    <div class="col-sm-3">
      <b> {% trans "Diagnosis:" %} </b>
    </div>
    <div class="col">
      {% for disease in report.diagnosis.get_queryset %}
        <p class='mb-1'> {{ disease }}</p>
      {% endfor %}
    </div>
  </div>
  <div class="row mb-2 col-md-12 border-top">
    <div class="col-sm-3">
      <b> {% trans "Prescription:" %} </b>
    </div>
    <div class="col">
      {{ report.prescription }}
    </div>
  </div>
  <div class="row mb-2 col-md-12 border-top">
    <div class="col-sm-3">
      <b> {% trans "Doctor:" %} </b>
    </div>
    <div class="col">
      {{ report.doctor }}
    </div>
  </div>
  {% if request.user.is_staff %}
  <div class="row mb-2 col-md-12 border-top">
    <div class="col-sm-3">
      <b> {% trans "Visit price:" %} </b>
    </div>
    <div class="col" {% if not report.city.district in report.doctor.districts.all or report.visit_price == 0 %} style="color: red; font-weight: bold;" {% endif %}>
      {{ report.visit_price }}
    </font>
    </div>
  </div>
  {% endif %}
  <div class="row mb-2 col-md-12 border-top">
    <div class="col-sm-3">
      <b> {% trans "Service items:" %} </b>
    </div>
    <div class="col">
      {% for service in report.service_items.get_queryset %}
        <p class='mb-1'>
          {% if request.user.is_staff %} {{ service.cost }} {% endif %}
          {{ service }}
        </p>
      {% endfor %}
    </div>
  </div>
  {% if request.user.is_staff %}
  <div class="row mb-2 col-md-12 border-top">
    <div class="col-sm-3">
      <b> {% trans "Total price:" %} </b>
    </div>
    <div class="col">
      {{ report.get_total_price }}
    </div>
  </div>
  {% endif %}
  <div class="row mb-2 col-md-12 border-top">
    <div class="col-sm-3 mb-2">
      <b> {% trans "Images:" %} </b>
    </div>
  </div>
  <div class="row mb-2 col-md-12 border-top">
    <div class="col">
      {% for image in report.additional_images.get_queryset %}
        <p class='mb-2'><img src="{{ image.image.url }}" alt="" width='80%'></p>
      {% endfor %}
    </div>
  </div>
</div>
{% if request.user.is_staff %}
<form action="{{ report.get_absolute_url }}" method="post">
  {% csrf_token %}
  <input class="btn {% if report.checked %}btn-secondary{% else %}btn-primary{% endif %}" type="submit" name="is_checked" value={% trans "Is checked" %}>
</form>
{% endif %}
{% endblock %}
