{% extends 'reports/base_reports.html' %}
{% load static %}

{% block title %}
  {{ block.super }} - Create report
{% endblock %}

{% block admin-panel-content %}
{% endblock %}

{% block content %}
<form action="{% url 'report_create_url' %}" method="post" enctype="multipart/form-data">
  {% csrf_token %}
  <table class='table mt-5'>
    {{ form.as_table }}
  </table>
  <table class="table">
    {{ service_items.management_form }}
    {{ service_items.non_form_errors }}
    {% for form in service_items.forms %}
    {% if forloop.first %}
    <thead>
      <tr>
        {% for field in form.visible_fields %}
        <th>{{ field.label|capfirst }}</th>
        {% endfor %}
      </tr>
    </thead>
    {% endif %}
    <tr class="formset_row">
      {% for field in form.visible_fields %}
      <td>
        {% if forloop.first %}
          {% for hidden in form.hidden_fields %}
            {{ hidden }}
          {% endfor %}
        {% endif %}
        {{ field.errors.as_ul }}
        {{ field }}
      </td>
      {% endfor %}
    </tr>
    {% endfor %}
  </table>
  <p>{{ images.as_p }}</p>
  <button type="submit" name="Create" class="btn btn-primary">Create report</button>

</form>
  <script src="//ajax.googleapis.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>
  <script src="{% static 'js/formset/jquery.formset.js' %}"></script>
  <script type="text/javascript">
  $('.formset_row').formset({
    addText: 'add service item',
    deleteText: 'remove',
    prefix: '{{ service_items.prefix }}',
    formTemplate: null,
    addCssClass: 'add-row',
    deleteCssClass: 'delete-row',
    formCssClass: 'dynamic-form',
    extraClasses: [],
    keepFieldValues: ":input[name$='service_price'],:input[name$='quantity']",
    added: (row)=>{ row.find('select[name*="service_items"]').djangoSelect2() },
    removed: null
  });
</script>
{{ form.media.js }}
{% endblock %}
